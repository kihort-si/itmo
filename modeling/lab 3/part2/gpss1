; --- ОПРЕДЕЛЕНИЕ ПАРАМЕТРОВ ---
A_MEAN1 EQU 1.0 ; Среднее обслуживание для узла 1
A_MEAN2 EQU 10.0 ; Среднее обслуживание для узла 2
A_MEAN3 EQU 4.5 ; Среднее обслуживание для узла 3
; --- ВЕРОЯТНОСТИ ПЕРЕХОДОВ —
P_11 EQU 0.4 
P_12 EQU 0.7
P_13 EQU 0.3
M_COUNT EQU 10 ; Количество заявок, которое будет сгенерировано в начале симуляции
SIM_TIME EQU 100000
qq EQU 0.7 ; Вероятность выбора первого потока 
tt_1 EQU 15 ; Матожидание первого распределения
tt_2 EQU 15 ; Параметр второго распределения
N_1 STORAGE 1 ; В узле 1 — 1 прибор
N_2 STORAGE 2 ; В узле 2 — 2 прибора
N_3 STORAGE 1 ; В узле 3 — 1 прибор

Erl_2 VARIABLE (Exponential(7,0,A_MEAN2/2))+(Exponential(8,0,A_MEAN2/2)); сл.величина по закону Эрланга 2-го порядка
GENERATE ,,,M_COUNT ; Генерация заявок, M_COUNT — это количество заявок, которое будет создано в начале симуляции.

SERV1 QUEUE queue_1 ; Вход в очередь
  ENTER N_1 ; Заявка входит в очередь на обслуживание в узле 1
  DEPART queue_1 ; Заявка покидает очередь узла 1 после обслуживания
  ADVANCE (Exponential(3,0,A_MEAN1)) ; Обслуживание заявки в узле 1 по экспоненциальному закону с параметром A_MEAN1. Используем RNG 3
  LEAVE N_1 ; Заявка покидает узел 1 после завершения обслуживания
  ASSIGN 1,(Uniform(1,0,1)) ; Присваивание случайного значения P1, равномерно распределенного от 0 до 1
  TEST G P1,P_11,SERV1 ; Если P1 < P_11, то заявка возвращается в SERV1 (переходит в этот же узел)
  TEST G P1,P_12,SERV2 ; Если P1 >= P_11, но < P_12, то заявка переходит в SERV2 (узел 2)
  TRANSFER ,SERV3 ; Иначе заявка переходит в SERV3 (узел 3)

SERV2 QUEUE queue_2 ; Вход в очередь
  ENTER N_2 ; Заявка входит в очередь на обслуживание в узле 2
  DEPART queue_2 ; Заявка покидает очередь узла 2 после обслуживания
  ADVANCE (Exponential(4,0,A_MEAN2)) ; Используем RNG 4
  LEAVE N_2 ; Заявка покидает узел 2 после завершения обслуживания
  TRANSFER ,SERV1  ; После обслуживания заявка переходит обратно в SERV1 (узел 1)

SERV3 QUEUE queue_3 ; Вход в очередь
  ENTER N_3 ; Заявка входит в очередь на обслуживание в узле 3
  DEPART queue_3 ; Заявка покидает очередь узла 3 после обслуживания
  ADVANCE (Exponential(5,0,A_MEAN3)) ; Обслуживание заявки в узле 3 по экспоненциальному закону с параметром A_MEAN3
  LEAVE N_3 ; Заявка покидает узел 3 после завершения обслуживания
  TRANSFER ,SERV1 ; После обслуживания заявка возвращается в SERV1 (узел 1)
GENERATE SIM_TIME
TERMINATE 1 ; Завершение работы симуляции

START 1
PROCEDURE hyper1(RN_H, qq, tt_1, tt_2) BEGIN
  if (uniform(1,0,1) < qq) then return exponential(RN_H,0,tt_1);
  else return exponential(RN_H,0,tt_2);
END;
