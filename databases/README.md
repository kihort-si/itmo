# Базы данных

## **О предмете**

Курс включает в себя информацию о проектировании и написании базы данных на языке PostgreSQL, создании инфологической и даталогической моделей, составлении запросов, написании триггеров, функций и индексов.

Продолжительность: 1 семестр.

## **Лабораторные работы**

### [**Лабораторная работа №1**](https://github.com/kihort-si/itmo/tree/main/databases/lab%201)

![PostgreSQL](https://github.com/kihort-si/itmo/blob/main/common/postgres.svg)

Вариант № 666

На основе предложенной предметной области (текста) составить ее описание. Из полученного описания выделить сущности, их атрибуты и связи.

Составить инфологическую модель.

Составить даталогическую модель. При описании типов данных для атрибутов должны использоваться типы из СУБД PostgreSQL.

Реализовать даталогическую модель в PostgreSQL. При описании и реализации даталогической модели должны учитываться ограничения целостности, которые характерны для полученной предметной области.

Заполнить созданные таблицы тестовыми данными.

Описание предметной области:

Пальцы ученого заплясали по клавиатуре. Он набрал десяток слов, па первый взгляд случайных, тщательно произнося каждое, когда оно появлялось на экране дисплея. Они возвращались из динамика как искаженное эхо - безжизненные, даже механические, за ними не чувствовалось разума. Нет, это не ЭАЛ, подумал Флойд, Это просто говорящая игрушка - первые из них появились во времена моего детства...

### [**Лабораторная работа №2**](https://github.com/kihort-si/itmo/tree/main/databases/lab%202)

![PostgreSQL](https://github.com/kihort-si/itmo/blob/main/common/postgres.svg)

Вариант № 716

Составить запросы на языке SQL (пункты 1-7).
1. Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры по указанным условиям: Н_ТИПЫ_ВЕДОМОСТЕЙ, Н_ВЕДОМОСТИ. Вывести атрибуты: Н_ТИПЫ_ВЕДОМОСТЕЙ.НАИМЕНОВАНИЕ, Н_ВЕДОМОСТИ.ИД. Фильтры (AND): a) Н_ТИПЫ_ВЕДОМОСТЕЙ.ИД = 2. b) Н_ВЕДОМОСТИ.ДАТА = 2010-06-18. c) Н_ВЕДОМОСТИ.ДАТА < 2022-06-08. Вид соединения: RIGHT JOIN.
2. Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры по указанным условиям: Таблицы: Н_ЛЮДИ, Н_ВЕДОМОСТИ, Н_СЕССИЯ. Вывести атрибуты: Н_ЛЮДИ.ОТЧЕСТВО, Н_ВЕДОМОСТИ.ДАТА, Н_СЕССИЯ.ЧЛВК_ИД. Фильтры (AND): a) Н_ЛЮДИ.ИД < 142095. b) Н_ВЕДОМОСТИ.ДАТА < 2010-06-18. Вид соединения: LEFT JOIN.
3. Вывести число фамилий без учета повторений. При составлении запроса нельзя использовать DISTINCT.
4. Выдать различные фамилии преподавателей и число людей с каждой из этих фамилий, ограничив список фамилиями, встречающимися ровно 10 раз на ФКТИУ. Для реализации использовать подзапрос.
5. Выведите таблицу со средними оценками студентов группы 4100 (Номер, ФИО, Ср_оценка), у которых средняя оценка равна средней оценк(е|и) в группе 1100.
6. Получить список студентов, отчисленных до первого сентября 2012 года с очной формы обучения. В результат включить: номер группы; номер, фамилию, имя и отчество студента; номер пункта приказа; Для реализации использовать соединение таблиц.
7. Вывести список студентов, имеющих одинаковые имена, но не совпадающие ид.


### [**Лабораторная работа №3**](https://github.com/kihort-si/itmo/tree/main/databases/lab%203)

![PostgreSQL](https://github.com/kihort-si/itmo/blob/main/common/postgres.svg)

Для отношений, полученных при построении предметной области из лабораторной работы №1, выполните следующие действия:
- Опишите функциональные зависимости для отношений полученной схемы (минимальное множество);
- Приведите отношения в 3NF (как минимум). Постройте схему на основеNF (как минимум).
- Опишите изменения в функциональных зависимостях, произошедшие после преобразования в 3NF (как минимум). Постройте схему на основеNF;
- Преобразуйте отношения в BCNF. Докажите, что полученные отношения представлены в BCNF. Если ваша схема находится уже в BCNF, докажите это;
- Какие денормализации будут полезны для вашей схемы? Приведите подробное описание.

Придумайте триггер и связанную с ним функцию, относящиеся к вашей предметной области, согласуйте их с преподавателем и реализуйте на языке PL/pgSQL.

### [**Лабораторная работа №4**](https://github.com/kihort-si/itmo/tree/main/databases/lab%204)

![PostgreSQL](https://github.com/kihort-si/itmo/blob/main/common/postgres.svg)

Вариант № 726

Составить запросы на языке SQL (пункты 1-2).

Для каждого запроса предложить индексы, добавление которых уменьшит время выполнения запроса (указать таблицы/атрибуты, для которых нужно добавить индексы, написать тип индекса; объяснить, почему добавление индекса будет полезным для данного запроса).

Для запросов 1-2 необходимо составить возможные планы выполнения запросов. Планы составляются на основании предположения, что в таблицах отсутствуют индексы. Из составленных планов необходимо выбрать оптимальный и объяснить свой выбор. Изменятся ли планы при добавлении индекса и как?

Для запросов 1-2 необходимо добавить в отчет вывод команды EXPLAIN ANALYZE [запрос]

Подробные ответы на все вышеперечисленные вопросы должны присутствовать в отчете (планы выполнения запросов должны быть нарисованы, ответы на вопросы - представлены в текстовом виде).

1. Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры по указанным условиям: Н_ТИПЫ_ВЕДОМОСТЕЙ, Н_ВЕДОМОСТИ. Вывести атрибуты: Н_ТИПЫ_ВЕДОМОСТЕЙ.ИД, Н_ВЕДОМОСТИ.ДАТА. Фильтры (AND): a) Н_ТИПЫ_ВЕДОМОСТЕЙ.НАИМЕНОВАНИЕ = Перезачет. b) Н_ВЕДОМОСТИ.ИД < 1426978. c) Н_ВЕДОМОСТИ.ИД < 1250981. Вид соединения: RIGHT JOIN.
2. Сделать запрос для получения атрибутов из указанных таблиц, применив фильтры по указанным условиям: Таблицы: Н_ЛЮДИ, Н_ВЕДОМОСТИ, Н_СЕССИЯ. Вывести атрибуты: Н_ЛЮДИ.ОТЧЕСТВО, Н_ВЕДОМОСТИ.ЧЛВК_ИД, Н_СЕССИЯ.ЧЛВК_ИД. Фильтры (AND): a) Н_ЛЮДИ.ИД < 163484. b) Н_ВЕДОМОСТИ.ЧЛВК_ИД < 163249. Вид соединения: LEFT JOIN.